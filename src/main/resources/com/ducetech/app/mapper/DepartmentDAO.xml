<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"      
 "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

<mapper namespace="com.ducetech.app.dao.DepartmentDAO">
	<resultMap type="com.ducetech.app.model.Department" id="departmentMap">
		<id column="node_code" property="nodeCode"/>
    	<result column="node_name" property="nodeName"/>
    	<result column="node_order" property="nodeOrder"/>
    	<result column="if_use" property="ifUse"/>
        <result column="creator_id" property="creatorId"/>
        <result column="updator_id" property="updatorId"/>
    	<result column="created_at" property="createdAt"/>
    	<result column="updated_at" property="updatedAt"/>
	</resultMap>

	<!-- 根据部门名称获取 -->
	<select id="selectDepartmentByNodeName" resultMap="departmentMap">
		select department_id, node_code, node_name, node_order,if_use, creator_id, updator_id, created_at, updated_at from department where node_name=#{nodeName}
	</select>

    <!-- 根据部门编码获取 -->
    <select id="selectDepartmentByNodeCode" resultMap="departmentMap">
        select department_id, node_code, node_name, node_order,if_use, creator_id, updator_id, created_at, updated_at from department where node_code=#{nodeCode}
    </select>

    <!-- 根据部门编码获取 -->
    <select id="selectByParentCode" resultMap="departmentMap">
        select department_id, node_code, node_name, node_order,if_use, creator_id, updator_id, created_at, updated_at from department
            where node_code like #{nodeCode} and length(node_code)=#{nodeCodeLength} order by node_code
    </select>

	<!-- 根据ID精确查找部门 -->
	<select id="selectDepartmentByDepartmentId" resultMap="departmentMap">
		select department_id, node_code, node_name, node_order,if_use, creator_id, updator_id, created_at, updated_at from department where department_id=#{departmentId}
	</select>
	
	<!-- 对部门的通用查询  -->
	<select id="selectDepartment" parameterType="com.ducetech.app.model.Department" resultMap="departmentMap">
		select department_id, node_code, node_name, node_order,if_use, creator_id, updator_id, created_at, updated_at from department where 1=1
		<if test="nodeCode!=null and nodeCode!=''">
			and node_code=#{nodeCode}
		</if>
		<if test="nodeName!=null and nodeName!=''">
			and node_name like '%' #{nodeName} '%'
		</if>
		<if test="creatorId!=null and creatorId!=''">
			and creator_id=#{creatorId}
		</if>
		<if test="createdAt!=null and createdAt!=''">
			and created_at=#{createdAt}
		</if>
		<if test="isDeleted!=null and isDeleted!=''">
			and is_deleted=#{isDeleted}
		</if>
	</select>
	
	<!-- 插入新部门 -->
	<insert id="insertDepartment" useGeneratedKeys="true" keyProperty="departmentId">
		insert into department (node_code,node_name,node_order,if_use,creator_id,created_at)
		values(#{nodeCode},#{nodeName},#{nodeOrder},#{ifUse},#{creatorId},#{createdAt})
	</insert>
	
	<!-- 更新某部门信息 -->
	<update id="updateDepartment" parameterType="com.ducetech.app.model.Department">
		update department 
		<set>
			<if test="nodeCode != null and nodeCode != ''">
				node_code=#{nodeCode},
			</if>
			<if test="nodeName != null and nodeName != ''">
				node_name=#{nodeName},
			</if>
		</set>
		where department_id=#{departmentId}
	</update>
</mapper>