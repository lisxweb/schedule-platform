<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>人员分组</title>
    #set($path = ${rc.contextPath})
    <link rel="stylesheet" href="$path/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="$path/static/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="$path/static/css/common.css">
    <link rel="stylesheet" href="$path/static/css/font.css">
    <link rel="stylesheet" href="$path/static/css/bootstrap-datetimepicker.css">
    <link rel="stylesheet" href="$path/static/css/style.css">
    <script src="$path/static/js/jquery.min.js" type="text/javascript"></script>
    <script src="$path/static/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="$path/static/js/underscore-min.js" type="text/javascript"></script>
    <script src="$path/static/js/moment.min.js" type="text/javascript"></script>
    <script src="$path/static/js/common.js" type="text/javascript"></script>
    <script src="$path/static/js/alert.js" type="text/javascript"></script>
    <script src="$path/static/js/index.js" type="text/javascript"></script>
    <!-- jqgrid -->
    <script src="$path/static/js/jqgrid/grid.locale-cn.js" type="text/javascript"></script>
    <script src="$path/static/js/jqgrid/jquery.jqGrid.min.js" type="text/javascript"></script>
    <script src="$path/static/js/jqgrid/table-jqgrid.js" type="text/javascript"></script>
    <!-- json-serializeObject -->
    <script src="$path/static/js/json/json-serializeObject.js" type="text/javascript"></script>
    <script src="$path/static/js/bootstrap-datetimepicker.js" type="text/javascript"></script>
</head>
<body>
<!-- 右侧内容 start -->
<div class="content-header">
    <div class="float-left">
        <a class="btnDefault bgGreen" href="javascript:;" onclick="addStationArea()" >新增站区</a>
    </div>
</div>
<!-- 右侧内容 end -->
<!-- 表格 start -->
<div class="wrapper">
    <p class="heading">北京地铁运三分公司</p>
    <div class="stationArea">
        #foreach($area in $stationArea)
            <div class="list">
                <div class="station-head">
                    <span>$area.getNodeName()</span>
                    <div class="dropdown">
                        <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">操作
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                            <li role="presentation">
                                <a role="menuitem" href="javascript:;" id="editStationAreaBtn" nodeCode="$area.getNodeCode()" nodeName="$area.getNodeName()">修改站区名称</a>
                            </li>
                            <li role="presentation">
                                <a role="menuitem" href="#addStation" data-toggle="modal" data-target="#addStation">添加站点</a>
                            </li>
                            <li role="presentation">
                                <a class="delete" role="menuitem" stationAreaId="$area.getDepartmentId()" href="javascript:;">删除站区</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="stations">
                    <ul>
                        #foreach($station in $area.getStations())
                        <li>
                            <span name="editStationSpan">$station.getNodeName()</span>
                            <a class="delete icon-1" href="javascript:;"></a>
                            <a class="edit editStation icon-4" href="javascript:;"></a>
                        </li>
                        #end
                        <li class="clear"></li>
                    </ul>
                </div>
            </div>
        #end
</div>
<!-- 表格 end -->
<!-- 新增站区 -->
<div class="modal" id="addArea" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <a href="javascript:;" class="close icon-1" data-dismiss="modal" aria-label="Close"></a>
                <h4 class="modal-title">新增站区</h4>
            </div>
            <div class="modal-body">
                <form class="form-container clear" id="addStationAreaForm">
                    <div class="form_line">
                        <label>站区名称</label>
                        <input type="text" id="addStationAreaName" name="nodename">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <a class="btn btn-confirm" onclick="addStationArea()" href="javascript:;">保存</a>
                <button class="btn btn-cancel" href="javascript:;" data-dismiss="modal" aria-label="Close">取消</button>
            </div>
        </div>
    </div>
</div>
<!-- 修改站区名称 -->
<div class="modal" id="editArea" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <a href="javascript:;" class="close icon-1" data-dismiss="modal" aria-label="Close"></a>
                <h4 class="modal-title">修改站区名称</h4>
            </div>
            <div class="modal-body">
                <form class="form-container clear">
                    <div class="form_line">
                        <label>站区名称</label>
                        <input type="hidden" id="editStationAreaCode" name="nodeCode">
                        <input type="text" id="editStationAreaName" name="nodename">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <a class="btn btn-confirm" onclick="editStationArea()" href="javascript:;">保存</a>
                <button class="btn btn-cancel" href="javascript:;" data-dismiss="modal" aria-label="Close">取消</button>
            </div>
        </div>
    </div>
</div>
<!-- 添加站点 -->
<div class="modal" id="addStation" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog " role="document">
        <div class="modal-content">
            <div class="modal-header">
                <a href="javascript:;" class="close icon-1" data-dismiss="modal" aria-label="Close"></a>
                <h4 class="modal-title">添加站点</h4>
            </div>
            <div class="modal-body">
                <form class="form-container clear" id="addStationForm">
                    <div class="form_line">
                        <label>站点名称</label>
                        <input type="hidden" id="parentNode" name="parentNode">
                        <input type="text" id="addStationName" name="nodename">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <a class="btn btn-confirm" href="javascript:;" onclick="addStation()">保存</a>
                <button class="btn btn-cancel" href="javascript:;" data-dismiss="modal" aria-label="Close">取消</button>
            </div>
        </div>
    </div>
</div>
</body>
<script>
    function addStation(){
        jQuery.ajax({
            async: false,
            type: "post",
            url: "$path/dept/addStationForm",
            data: $('#addStationForm').serialize(),
            dataType: "json",
            error: function (request) {
                alert("网络错误");
            },
            success: function (data) {
                alert(data.msg)
                setTimeout(function(){
                    $("#addStation .close").click();
                    $("#addStation").hide();
                },500)
                $(".ui-jqgrid-btable").jqGrid().trigger('reloadGrid');
            }
        });
    }
    $("#editStationAreaBtn").click(function(){
        $("#editArea").show();
        var nodeCode = $(this).attr("nodeCode");
        var nodename = $(this).attr("nodename");
        console.log(nodeCode+"|||"+nodename)
        $("#editStationAreaCode").val(nodeCode);
        $("#editStationAreaName").val(nodename);
    });
    function editStationArea(){
        jQuery.ajax({
            async: false,
            type: "put",
            url: "$path/dept/editStationAreaForm",
            data: $('#editStationAreaForm').serialize(),
            dataType: "json",
            error: function (request) {
                alert("网络错误");
            },
            success: function (data) {
                alert(data.msg)
                setTimeout(function(){
                    $("#editArea .close").click();
                    $("#editArea").hide();
                },500)
            }
        });
    }
    function addStationArea(){
        $("#addArea").show();
        var areaName = $("#addStationAreaName").val();
        if(areaName!=null&&areaName!='undefined'&&areaName!=''){
            jQuery.ajax({
                async: false,
                type: "post",
                url: "$path/dept/addStationAreaForm",
                data: $('#addStationAreaForm').serialize(),
                dataType: "json",
                error: function (request) {
                    alert("网络错误");
                },
                success: function (data) {
                    alert(data.msg)
                    setTimeout(function(){
                        $("#addArea .close").click();
                        $("#addArea").hide();
                    },500)
                    $(".ui-jqgrid-btable").jqGrid().trigger('reloadGrid');
                }
            });
        }
    }
</script>
</html>